<h1 class="sub-header">Riepilogo</h1>

<div class="mt-5">
  <h2>Strategie attive</h2>
  <label for="filter-pair">Filtra</label>
  <input type="text" id="filter-pair" class="ml-4" [(ngModel)]="searchFilter" (ngModelChange)="filterResult(searchFilter)">
  <table class="table-responsive">
    <tr>
      <th class="text-center">Stato</th>
      <th>Nome</th>
      <th class="hidden-column">Scambio</th>
      <th class="hidden-column">BTC iniziali</th>
      <th class="hidden-column">BTC attuali</th>
      <th class="hidden-column">Buy Price</th>
      <th class="hidden-column">Sell Price</th>
      <th>Data</th>
      <th>STOP</th>
      <th>CLOSE</th>
    </tr>
    <tr *ngFor="let str of activeStrategies; let $index =index; " (click)="openDetails(str)">
      <td class="text-center">
        <span (click)="openConfirmModal($index)" class="d-sm-block d-md-none">INFO</span>
        <span class="d-none d-lg-block">
          <img *ngIf="str.current_status == 'BUY'" src="assets/icons/dollar-sign-solid.svg" alt="buy" width="20">
          <img *ngIf="str.current_status != 'BUY'" src="assets/icons/dollar-sign.svg" alt="sell" width="20">
      </span>
      </td>
      <td>{{str.name}}</td>
      <td class="hidden-column">{{str.coin_pair}}</td>
      <td class="hidden-column">{{fromCoinToBTC(str.capital, 0.00000039).toFixed(8)}}</td>
      <td class="hidden-column">{{str.current_capital}}</td>
      <td class="hidden-column">{{str.buy_price.toFixed(8)}}</td>
      <td class="hidden-column">{{str.sell_price.toFixed(8)}}</td>
      <td>{{str.date | date}}</td>
      <td>
        <button (click)="openStopModal($index)" class="btn"
                [ngClass]="{'btn-danger':str.status == 'ACTIVE','btn-success':str.status != 'ACTIVE'}">
          <span *ngIf="str.status == 'ACTIVE'">STOP</span>
          <span *ngIf="str.status != 'ACTIVE'">RESTART</span>
        </button>
      </td>
      <td>
        <button class="btn btn-dark" (click)="cancelStrategy(str.order_id , str.coin_pair, str.name)">
          CLOSE
        </button>
      </td>

    </tr>

  </table>
  <modal id="edit-modal" #detailsModal>
    <div class="app-modal-header"><h3>Dettagli: </h3></div>
    <div class="app-modal-body" *ngIf="checkMobileData">
      <p>{{checkMobileData.name}}</p>
      <p>{{checkMobileData.coin_pair}}</p>
      <p>{{checkMobileData.capital}}</p>
      <p>{{checkMobileData.capital}}</p>
      <p>{{checkMobileData.buy_price.toFixed(8)}}</p>
      <p>{{checkMobileData.sell_price.toFixed(8)}}</p>
      <p>{{checkMobileData.date}}</p>
    </div>
  </modal>
  <modal id="stop-modal" #stopModal>
    <div class="app-modal-header"><h3>STOP </h3></div>
    <div class="app-modal-body">
      <div class="text-center">
        <h2 *ngIf="stopData"><span *ngIf="stopData.status === 'ACTIVE'">Stai fermando</span> <span
          *ngIf="stopData.status !== 'ACTIVE'">Stai restartando</span>  {{stopData.name}}</h2>
        <h2>Conferma !!</h2>
      </div>
      <button class="btn btn-danger float-left" (click)="closeStop()">CHIUDI</button>
      <button class="btn start-btn float-right" (click)="updateStrategy(stopData.name,stopData.status)">
        CONTINUE
      </button>
    </div>
  </modal>
</div>
