<h1 class="sub-header">Riepilogo</h1>

<div class="mt-5">
  <h2>Strategie attive</h2>
  <table class="table-responsive">
    <tr class="text-center">
      <th>Stato</th>
      <th>Nome</th>
      <th >Scambio</th>
      <th class="hidden-column">BTC iniziali</th>
      <th class="hidden-column">BTC attuali</th>
      <th class="hidden-column">Prezzo di compera</th>
      <th class="hidden-column">Prezzo di vendita</th>
      <th>Data</th>
      <th>PAUSA</th>
      <th>CHIUDI</th>
    </tr>
    <tr>
      <td>
        <label class="mr-1 label-custom" for="all">
          <input id="all" type="radio" value="all" class="radio-dash all" [(ngModel)]="searchState"
                 (ngModelChange)="filterResult(searchState,'state')">
          <svg [ngStyle]="{'opacity': searchState == 'all' ? '1' : '0.5'}"  aria-hidden="true" focusable="false" data-prefix="fas" data-icon="dollar-sign" class="svg-inline--fa fa-dollar-sign fa-w-9" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 288 512"><path fill="blue" d="M209.2 233.4l-108-31.6C88.7 198.2 80 186.5 80 173.5c0-16.3 13.2-29.5 29.5-29.5h66.3c12.2 0 24.2 3.7 34.2 10.5 6.1 4.1 14.3 3.1 19.5-2l34.8-34c7.1-6.9 6.1-18.4-1.8-24.5C238 74.8 207.4 64.1 176 64V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48h-2.5C45.8 64-5.4 118.7.5 183.6c4.2 46.1 39.4 83.6 83.8 96.6l102.5 30c12.5 3.7 21.2 15.3 21.2 28.3 0 16.3-13.2 29.5-29.5 29.5h-66.3C100 368 88 364.3 78 357.5c-6.1-4.1-14.3-3.1-19.5 2l-34.8 34c-7.1 6.9-6.1 18.4 1.8 24.5 24.5 19.2 55.1 29.9 86.5 30v48c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-48.2c46.6-.9 90.3-28.6 105.7-72.7 21.5-61.6-14.6-124.8-72.5-141.7z"></path></svg>
        </label>
        <label class="mr-1 label-custom" for="buy">
          <input id="buy" type="radio" value="buy" class="radio-dash buy" [(ngModel)]="searchState"
                 (ngModelChange)="filterResult(searchState,'state')">
          <svg [ngStyle]="{'opacity': searchState == 'buy' ? '1' : '0.5'}"  aria-hidden="true" focusable="false" data-prefix="fas" data-icon="dollar-sign" class="svg-inline--fa fa-dollar-sign fa-w-9" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 288 512"><path fill="green" d="M209.2 233.4l-108-31.6C88.7 198.2 80 186.5 80 173.5c0-16.3 13.2-29.5 29.5-29.5h66.3c12.2 0 24.2 3.7 34.2 10.5 6.1 4.1 14.3 3.1 19.5-2l34.8-34c7.1-6.9 6.1-18.4-1.8-24.5C238 74.8 207.4 64.1 176 64V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48h-2.5C45.8 64-5.4 118.7.5 183.6c4.2 46.1 39.4 83.6 83.8 96.6l102.5 30c12.5 3.7 21.2 15.3 21.2 28.3 0 16.3-13.2 29.5-29.5 29.5h-66.3C100 368 88 364.3 78 357.5c-6.1-4.1-14.3-3.1-19.5 2l-34.8 34c-7.1 6.9-6.1 18.4 1.8 24.5 24.5 19.2 55.1 29.9 86.5 30v48c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-48.2c46.6-.9 90.3-28.6 105.7-72.7 21.5-61.6-14.6-124.8-72.5-141.7z"></path></svg>
        </label>
        <label for="sell" class="label-custom">
          <input id="sell" type="radio" value="sell" class="radio-dash sell" [(ngModel)]="searchState"
                 (ngModelChange)="filterResult(searchState,'state')">
          <svg [ngStyle]="{'opacity': searchState == 'sell' ? '1' : '0.5'}" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="dollar-sign" class="svg-inline--fa fa-dollar-sign fa-w-9" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 288 512"><path fill="red" d="M209.2 233.4l-108-31.6C88.7 198.2 80 186.5 80 173.5c0-16.3 13.2-29.5 29.5-29.5h66.3c12.2 0 24.2 3.7 34.2 10.5 6.1 4.1 14.3 3.1 19.5-2l34.8-34c7.1-6.9 6.1-18.4-1.8-24.5C238 74.8 207.4 64.1 176 64V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48h-2.5C45.8 64-5.4 118.7.5 183.6c4.2 46.1 39.4 83.6 83.8 96.6l102.5 30c12.5 3.7 21.2 15.3 21.2 28.3 0 16.3-13.2 29.5-29.5 29.5h-66.3C100 368 88 364.3 78 357.5c-6.1-4.1-14.3-3.1-19.5 2l-34.8 34c-7.1 6.9-6.1 18.4 1.8 24.5 24.5 19.2 55.1 29.9 86.5 30v48c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-48.2c46.6-.9 90.3-28.6 105.7-72.7 21.5-61.6-14.6-124.8-72.5-141.7z"></path></svg>
        </label>
      </td>
      <td>
        <input type="text" id="filter-name" class="filter-dash" [(ngModel)]="searchName"
               (ngModelChange)="filterResult(searchName,'name')">
      </td>
      <td><input type="text" id="filter-pair" class="filter-dash" [(ngModel)]="searchFilter"
                 (ngModelChange)="filterResult(searchFilter,'pairs')"></td>
      <td class="hidden-column"><input type="text" class="filter-dash " [disabled]="true"></td>
      <td class="hidden-column"><input type="text" class="filter-dash " [disabled]="true"></td>
      <td class="hidden-column"><input type="text" class="filter-dash " [disabled]="true"></td>
      <td class="hidden-column"><input type="text" class="filter-dash " [disabled]="true"></td>
      <td><input type="text" id="filter-date" class="filter-dash" [(ngModel)]="searchDate"
                 (ngModelChange)="filterResult(searchDate,'date')"></td>
      <td><input type="text" class="filter-dash min" [disabled]="true"></td>
      <td><input type="text" class="filter-dash min" [disabled]="true"></td>
    </tr>
    <tr *ngFor="let str of activeStrategies; let $index =index; ">
      <td style="cursor: pointer" class="text-center" (click)="openDetails($index)">
<!--        <span (click)="openConfirmModal($index)" class="d-sm-block d-md-none">INFO</span>-->
        <span class="">
          <img *ngIf="str.current_status == 'BUY'" src="assets/icons/dollar-sign-solid.svg" alt="buy" width="18">
          <img *ngIf="str.current_status != 'BUY'" src="assets/icons/dollar-sign.svg" alt="sell" width="18">
      </span>
      </td>
      <td>{{str.name}}</td>
      <td >{{str.coin_pair}}</td>
      <td class="hidden-column">{{str.capital}}</td>
      <td class="hidden-column">{{str.current_status == 'BUY' ? str.current_capital : (str.current_capital * str.sell_price).toFixed(8) }}</td>
      <td class="hidden-column">{{str.buy_price.toFixed(8)}}</td>
      <td class="hidden-column">{{str.sell_price.toFixed(8)}}</td>
      <td>{{str.date | date:'dd/MM/yyyy'}}</td>
      <td>
        <button (click)="openStopModal($index)" class="btn"
                [ngClass]="{'btn-dark':str.status == 'ACTIVE','btn-success':str.status != 'ACTIVE'}">
          <span *ngIf="str.status == 'ACTIVE'"><img width="20" alt="pause"
                                                    src="assets/icons/pause-circle-solid.svg"></span>
          <span *ngIf="str.status != 'ACTIVE'"><img width="20" alt="play"
                                                    src="assets/icons/play-circle-solid.svg"></span>
        </button>
      </td>
      <td>
        <button class="btn btn-danger" (click)="openCancelModal($index)">
          <img alt="stop" src="assets/icons/stop-circle-solid.svg" width="20">
        </button>
      </td>
      <td *ngIf="str.transaction !== undefined " colspan="10">Bau</td>
    </tr>

  </table>
  <modal id="edit-modal" #detailsModal>
    <div class="app-modal-header"><h3>Dettagli: </h3></div>
    <div class="app-modal-body" *ngIf="checkMobileData">
      <p>{{checkMobileData.name}}</p>
      <p>{{checkMobileData.coin_pair}}</p>
      <p>{{checkMobileData.capital}}</p>
      <p>{{checkMobileData.capital}}</p>
      <p>{{checkMobileData.buy_price.toFixed(8)}}</p>
      <p>{{checkMobileData.sell_price.toFixed(8)}}</p>
      <p>{{checkMobileData.date}}</p>
    </div>
  </modal>
  <modal id="stop-modal" #stopModal>
    <div class="app-modal-header"><h3>STOP </h3></div>
    <div class="app-modal-body">
      <div class="text-center">
        <h2 *ngIf="stopData"><span *ngIf="stopData.status === 'ACTIVE'">Stai fermando</span> <span
          *ngIf="stopData.status !== 'ACTIVE'">Stai riavviando</span>  {{stopData.name}}</h2>
        <h2>Conferma !!</h2>
      </div>
      <button class="btn btn-danger float-left" (click)="closeStop()">CHIUDI</button>
      <button class="btn start-btn float-right" (click)="updateStrategy(stopData.name,stopData.status)">
        CONTINUA
      </button>
    </div>
  </modal>
  <modal id="cancel-modal" #cancelModal>
    <div class="app-modal-header"><h3>CANCEL </h3></div>
    <div class="app-modal-body">
      <div class="text-center">
        <h2 *ngIf="stopData">
          <span>Stai cancellando la strategia</span>
          {{stopData.name}}</h2>
        <h2>Conferma !!</h2>
      </div>
      <button class="btn btn-danger" (click)="closeCancel()">CHIUDI</button>
      <button class="btn start-btn float-right"
              (click)="cancelStrategy(stopData.order_id , stopData.coin_pair, stopData.name)">
        CONTINUA
      </button>
    </div>
  </modal>
  <modal id="transaction-modal" #transactionsModal>
    <div class="app-modal-header"><h3>TRANSAZIONI</h3></div>
    <div class="app-modal-body">
      <div class="text-center" *ngIf="stopData">
        <table class="table">
          <tr>
            <th>Id dell' Ordine</th>
            <th>Tipo</th>
            <th>Data</th>
            <th>Quantita</th>
          </tr>
          <tr *ngFor="let tr of stopData.transactions">
            <td>{{tr.order_id}}</td>
            <td>{{tr.type_transaction}}</td>
            <td>{{parseDate(tr.date)  }}</td>
            <td>{{tr.quantity ? tr.quantity : 'fake'}}</td>
          </tr>
        </table>
      </div>
    </div>
  </modal>
</div>
